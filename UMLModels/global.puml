@startuml

' === ENUMERATIONS ===
enum RuleType {
  Inclusion
  Exclusion
  Conditional
}

enum TargetType {
  Product
  Feature
  ProductType
}

enum Operator {
  =
  !=
  >
  <
  >=
  <=
  in
  not_in
}

enum ReferenceType {
  Measurement
  Enumeration
  Classification
  ColorSystem
  DateFormat
  TextFormat
}

' === PRODUCT MODEL ===
class Product {
  +productID : String
  +productType : String
  +name : String
  +description : String
}

class Feature {
  +featureName : String
  +featureValue : String
}

class Tag {
  +conceptID : String
  +label : String
}

Product "1" -- "0..*" Feature
Product "0..*" -- "0..*" Tag

' === FEATURE DEFINITION & REFERENCE SYSTEMS ===
class FeatureDefinition {
  +featureName : String
  +description : String
  +dataType : String
}

class ReferenceSystem {
  +systemID : String
  +name : String
  +description : String
  +type : ReferenceType
  +uri : String
}

class ReferenceUnit {
  +unitCode : String
  +unitName : String
  +symbol : String
  +conversionToBase : Float
}

class CodeListEntry {
  +code : String
  +label : String
  +definition : String
  +language : String
}

FeatureDefinition "1" -- "1" ReferenceSystem
ReferenceSystem "1" -- "0..*" ReferenceUnit
ReferenceSystem "1" -- "0..*" CodeListEntry

' === RULES MODEL ===
class ProductRule {
  +ruleID : String
  +ruleType : RuleType
  +description : String
}

class RuleCondition {
  +featureName : String
  +expectedValue : String
  +operator : Operator
}

class RuleTarget {
  +targetType : TargetType
  +targetID : String
}

class RuleScope {
  +location : String
  +segmentID : String
  +channel : String
}

ProductRule "1" -- "1..*" RuleTarget
ProductRule "0..*" -- "0..*" RuleCondition
ProductRule "0..1" -- "0..1" RuleScope

@enduml
@startuml global#1
skinparam packageStyle rectangle
skinparam classAttributeIconSize 0
skinparam linetype ortho
left to right direction

' === Layer 1: Abstract Core Model ===
package "Layer 1: Abstract Feature Model" as AFM {

 abstract class Product {
  +identifier
  +type
  +name : Text
  +description : Text
}

class LifecycleStatus <<Metadata>> {
  +status : StatusCode
  +since : Date
  +reason
}

enum StatusCode <<Metadata>> {
  +active
  +deprecated
  +onhold
  +new
  +deleted
  +archived
}

Product "1" -- "1" LifecycleStatus : has >
Product "1" *-- "1..*" Feature : has >
LifecycleStatus  .d.> StatusCode

  abstract class Feature {
    +identifier
    +name: Text
    +description: Text
  }

  abstract class FeatureValue {
    +unit
  }

  class SingleValue {
    +value
  }

class ValueRange {
  +minValue
  +maxValue
}

class DiscreteSet {
  +allowedValues: List
}


FeatureValue <|-- SingleValue
FeatureValue <|-- ValueRange
FeatureValue <|-- DiscreteSet

  Feature --> FeatureValue : has >

  class ReferenceSystem {
    +identifier
    +description
    +system_type
  }

  Feature --> ReferenceSystem : uses >
}

' === Layer 2: TransportProduct with Specialized Features ===
package "Layer 2: TransportProduct" as TP {

  enum TransportMode {
    Air
    Rail
    Bus
    Ferry
    Other
  }

  class TransportProduct {
    +identifier
    +name: Text
    +description: Text

    +origin: OriginFeature
    +destination: DestinationFeature
    +validityPeriod: ValidityPeriodFeature
    +transportMode: TransportModeFeature
  }
  
  Product <|- TransportProduct: derived from <
  TransportMode --> TransportModeFeature : uses >

  class OriginFeature
  class DestinationFeature
  class ValidityPeriodFeature
  class TransportModeFeature {
    +mode: TransportMode
  }

  SingleValue <|- OriginFeature: derived from <
  SingleValue <|- DestinationFeature: derived from <
  Feature <|- ValidityPeriodFeature: derived from <
  Feature <|-- TransportModeFeature: derived from <

  DestinationFeature -[hidden]-> OriginFeature
  ValidityPeriodFeature -[hidden]-> DestinationFeature
  TransportModeFeature -[hidden]-> ValidityPeriodFeature
}

AFM -d[hidden]-> TP
TP --d[hidden]> CPI

' === Layer 3: Concrete product instance ===

package "Layer 3: Concrete Product Instance" as CPI {

  object "LH1234_Economy : TransportProduct" as LH1234_Economy {
    identifier = "LH1234_ECO"
    name = "Flight LH1234 Economy Class"
    description = "Economy seat on LH1234 flight"
  }

  object  "Origin_LHR : OriginFeature" as Origin_LHR  {
    name = "Origin"
    description = "London Heathrow Airport"
  }

  object  "Destination_JFK : DestinationFeature" as Destination_JFK  {
    name = "Destination"
    description = "John F. Kennedy Airport"
  }

  object "Validity_Summer2025 : ValidityPeriodFeature" as Validity_Summer2025 {
    name = "Validity Period"
    description = "Valid from June to August 2025"
  }

  object  "TransportMode_Air : TransportModeFeature" as TransportMode_Air {
    name = "Transport Mode"
    description = "Air transport mode"
  }

  ' Feature Values
  object "Value_LHR : SingleValue" as Value_LHR {
    value = "LHR"
  }

  object "Value_JFK : SingleValue" as Value_JFK {
    value = "JFK"
  }

  object "Value_ValidSummer : SingleValue" as Value_ValidSummer {
    value = "2025-06 to 2025-08"
  }

  object "Value_ModeAir : SingleValue" as Value_ModeAir {
    value = "Air"
  }

  ' Reference Systems
  object "IATA_Codes : ReferenceSystem" as IATA_Codes {
    identifier = "IATA-Airport-Codes"
    description = "IATA 3-letter airport code system"
    system_type = "CodeSystem"
  }

  object "TransportModesRef : ReferenceSystem" as TransportModesRef {
    identifier = "Transport-Modes"
    description = "Standardized transport modes"
    system_type = "Enumeration"
  }

  ' Connect features to values and reference systems
  Origin_LHR --> Value_LHR
  Origin_LHR --> IATA_Codes

  Destination_JFK --> Value_JFK
  Destination_JFK --> IATA_Codes

  Validity_Summer2025 --> Value_ValidSummer

  TransportMode_Air --> Value_ModeAir
  TransportMode_Air --> TransportModesRef

  ' Connect concrete product to feature instances
  LH1234_Economy *-- Origin_LHR
  LH1234_Economy *-- Destination_JFK
  LH1234_Economy *-- Validity_Summer2025
  LH1234_Economy *-- TransportMode_Air
  
}

@enduml


@startuml global#2Layer1
' specializations across layers have been replaced by stereotypes 
' for better readability

skinparam packageStyle rectangle
skinparam classAttributeIconSize 0
skinparam linetype ortho
skinparam nodesep 100


' left to right direction

' === Layer 1: Abstract Core Model ===
package "Layer 1: Abstract Product Definition" as AFM {

 abstract class Product {
  +identifier
  +type
  +name : Text
  +description : Text
}

class ProductRule {
  +ruleID: String
  +name: String
  +description: String
  +type: RuleType
}

class TaxonomyConcept {
  +conceptID: String
  +prefLabel: String
}

class LifecycleStatus <<Metadata>> {
  +status : StatusCode
  +since : Date
  +reason
}

enum StatusCode <<Metadata>> {
  +active
  +deprecated
  +onhold
  +new
  +deleted
  +archived
}



Product "1" -- "1" LifecycleStatus : has >
Product "1" *-- "1..*" Feature : has >
LifecycleStatus  ..> StatusCode : uses >
Product "1" -r- "0..n" TaxonomyConcept: classified by >
Product "1" -l- "0..n" ProductRule: subject to >

abstract class Feature {
    +identifier
    +name: Text
    +description: Text
  }

abstract class FeatureValue {
    +unit
  }

abstract class SingleValue {
    +value
  }

abstract class ValueRange {
  +minValue
  +maxValue
}

abstract class DiscreteSet {
  +allowedValues: List
}


FeatureValue <|--- SingleValue
FeatureValue <|--- ValueRange
FeatureValue <|-- DiscreteSet

Feature --> "1" FeatureValue : has >

class ReferenceSystem {
    +identifier
    +description
    +system_type
  }

' === Reference System Type Enum ===
enum ReferenceSystemType {
  Measurement
  Enumeration
  CodeSystem
  ColorSystem
  Other
}

' === Abstract Reference Source ===
abstract class ReferenceSource {
  +authority: Text
  +resource_name: Text
  +resource_type: Text
}

' === Subtypes for Reference Sources ===
class ExternalReference {
  +link: Any // Any can be e.g. an url
}

class InternalReference {
  +repository_name: Text
  +version: Any
}

' === Relationships ===
ReferenceSystem -l-> ReferenceSystemType : is of type
ReferenceSystem --> ReferenceSource : definedBy

ReferenceSource <|-- ExternalReference
ReferenceSource <|-- InternalReference


FeatureValue <--l--- ReferenceSystem : applies to <
}
@enduml

@startuml global#2Layer2
' specializations across layers have been replaced by stereotypes 
' for better readability

skinparam packageStyle rectangle
skinparam classAttributeIconSize 0
skinparam linetype ortho


' === Layer 2: TransportProduct with Specialized Features ===
package "Layer 2: TransportProduct" as TP {

  enum TransportMode {
    Air
    Rail
    Bus
    Ferry
    Other
  }

  class TransportProduct <<Product>> {
    +identifier
    +name: Text
    +description: Text

    +origin: OriginFeature
    +destination: DestinationFeature
    +validityPeriod: ValidityPeriodFeature
    +transportMode: TransportModeFeature
  }
  
  ' Product <|- TransportProduct: derived from <
  TransportMode --> TransportModeFeature : uses >

  class OriginFeature <<SingleValue>>
  class DestinationFeature <<SingleValue>>
  class ValidityPeriodFeature <<ValueRange>>
  class TransportModeFeature <<SingleValue>> {
    +mode: TransportMode
  }

  'SingleValue <|- OriginFeature: derived from <
  'SingleValue <|- DestinationFeature: derived from <
  'Feature <|- ValidityPeriodFeature: derived from <
  'Feature <|-- TransportModeFeature: derived from <

  'DestinationFeature -[hidden]-> OriginFeature
  'ValidityPeriodFeature -[hidden]-> DestinationFeature
  'TransportModeFeature -[hidden]-> ValidityPeriodFeature
}

@enduml
@startuml global#2Layer3
' === Layer 3: Concrete product instance ===

package "Layer 3: Concrete Product Instance" as CPI {

  object "LH1234_Economy : TransportProduct" as LH1234_Economy {
    identifier = "LH1234_ECO"
    name = "Flight LH1234 Economy Class"
    description = "Economy seat on LH1234 flight"
  }

  object  "Origin_LHR : OriginFeature" as Origin_LHR  {
    name = "Origin"
    description = "London Heathrow Airport"
  }

  object  "Destination_JFK : DestinationFeature" as Destination_JFK  {
    name = "Destination"
    description = "John F. Kennedy Airport"
  }

  object "Validity_Summer2025 : ValidityPeriodFeature" as Validity_Summer2025 {
    name = "Validity Period"
    description = "Valid from June to August 2025"
  }

  object  "TransportMode_Air : TransportModeFeature" as TransportMode_Air {
    name = "Transport Mode"
    description = "Air transport mode"
  }

  ' Feature Values
  object "Value_LHR : SingleValue" as Value_LHR {
    value = "LHR"
  }

  object "Value_JFK : SingleValue" as Value_JFK {
    value = "JFK"
  }

  object "Value_ValidSummer : SingleValue" as Value_ValidSummer {
    value = "2025-06 to 2025-08"
  }

  object "Value_ModeAir : SingleValue" as Value_ModeAir {
    value = "Air"
  }

  ' Reference Systems
  object "IATA_Codes : ReferenceSystem" as IATA_Codes {
    identifier = "IATA-Airport-Codes"
    description = "IATA 3-letter airport code system"
    system_type = "CodeSystem"
  }

  object "TransportModesRef : ReferenceSystem" as TransportModesRef {
    identifier = "Transport-Modes"
    description = "Standardized transport modes"
    system_type = "Enumeration"
  }

  ' Connect features to values and reference systems
  Origin_LHR --> Value_LHR
  Origin_LHR --> IATA_Codes

  Destination_JFK --> Value_JFK
  Destination_JFK --> IATA_Codes

  Validity_Summer2025 --> Value_ValidSummer

  TransportMode_Air --> Value_ModeAir
  TransportMode_Air --> TransportModesRef

  ' Connect concrete product to feature instances
  LH1234_Economy *-- Origin_LHR
  LH1234_Economy *-- Destination_JFK
  LH1234_Economy *-- Validity_Summer2025
  LH1234_Economy *-- TransportMode_Air
  
}

@enduml
